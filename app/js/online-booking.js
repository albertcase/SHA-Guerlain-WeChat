(function(){"use strict";var e=function(){this.isShake=!1,this.mobileVal="",this.hasLogged=!1};e.prototype={init:function(){var e=this;e.bindEvent();var t=Common.queryString().servicefirst,n=Common.queryString().servicesecond;e.updateService(t,n)},bindEvent:function(){function e(e){this.children[0].value||(this.children[0].remove(),Common.addClass(this,"actived"))}var t=this;t.submitForm();for(var n=document.getElementsByTagName("select"),i=0;i<n.length;i++)n[i].addEventListener("change",e,!1)},presenvationDate:function(e){for(var t=document.getElementById("input-booking-date"),n=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],i=new Date,o=i.getFullYear(),l=i.getMonth()+1,a=i.getDate()+1,r=i.getDay(),m="",u=l,s=o,c=1;90>c;c++)u>0&&8>u?u%2?a>31&&(a=1,u++):2==u?s%4?a>28&&(a=1,u++):a>29&&(a=1,u++):a>30&&(a=1,u++):u>7&&13>u&&(u%2?a>30&&(a=1,u++):a>31&&(a=1,u++)),u>12&&(u=1,s++),r>6&&(r=0),"0"==e?6!=r&&(m=m+'<option value="'+u+"月"+a+"日 "+n[r]+'">'+u+"月"+a+"日 "+n[r]+"</option>"):m=m+'<option value="'+u+"月"+a+"日 "+n[r]+'">'+u+"月"+a+"日 "+n[r]+"</option>",a++,r++;t.innerHTML=m},formValidate:function(){var e=!0,t=document.getElementById("input-callname"),n=document.getElementById("input-surname"),i=document.getElementById("input-name"),o=document.getElementById("input-mobile"),l=document.getElementById("input-email");return t.value?Common.removeClass(t.parentElement,"error"):(Common.addClass(t.parentElement,"error"),e=!1),n.value?Common.removeClass(n.parentElement,"error"):(Common.addClass(n.parentElement,"error"),e=!1),i.value?Common.removeClass(i.parentElement,"error"):(Common.addClass(i.parentElement,"error"),e=!1),o.value?Common.removeClass(o.parentElement,"error"):(Common.addClass(o.parentElement,"error"),e=!1),l.value?Common.removeClass(l.parentElement,"error"):(Common.addClass(l.parentElement,"error"),e=!1),!!e},updateService:function(e,t){var n=this,i=$("#input-select-1"),o=($("#input-select-2"),$("#input-select-3"),$(".input-box-select-1"),$(".input-box-select-2"),$(".input-box-select-3"),$(".panel-select"),Api.serviceJson);if(i.on("change",function(){for(var e in o)o[e].title==$(this).val()&&n.initService(e,0)}),e)for(var l in o)if(o[l].title==e)if(o[l].type){for(var a in o[l].type)if(o[l].type[a].name==t)return void n.initService(l,a)}else n.initService(l,0);else l==o.length-1&&n.initService(0,0);else n.initService(0,0)},initService:function(e,t){var n=this,i=$("#input-select-1"),o=$("#input-select-2"),l=($("#input-select-3"),$(".input-box-select-1"),$(".input-box-select-2")),a=($(".input-box-select-3"),$(".panel-select"),$(".time-limit")),r=Api.serviceJson,m="";n.presenvationDate(e);for(var u in r)m=m+'<option value="'+r[u].title+'">'+r[u].title+"</option>";i.html(m).val(r[e].title),r[e].time?a.html("<p>"+r[e].time+"</p>"):a.html("");var s="";if(r[e].type){l.removeClass("hide");for(var c in r[e].type)s=s+'<option value="'+r[e].type[c].name+'">'+r[e].type[c].name+"</option>";o.html(s),o.val(r[e].type[t].name)}else l.addClass("hide"),o.html("")},submitForm:function(){var e=this,t=$(".btn-submit"),n=!0;t.on("touchstart",function(t){if(t.preventDefault(),e.formValidate()){if(!n)return;n=!1;for(var i=document.getElementById("input-callname").value,o=document.getElementById("input-surname").value,l=document.getElementById("input-name").value,a=document.getElementById("input-mobile").value,r=document.getElementById("input-email").value,m=document.getElementById("input-select-1").value,u=document.getElementById("input-select-2").value,s=document.getElementById("input-select-3").value,c=document.getElementById("input-booking-date").value,d=document.getElementById("youradvice").value,v=document.getElementsByTagName("input-contact"),p="电子邮件",f=0;f<v.length;f++)v[f].checked&&(p=v[f].value);Api.submitAll({sex:i,first:o,second:l,mobile:a,email:r,type:p,bak1:m,bak2:u,bak3:s,date:c,comment:d},function(e){1==e.code?Common.alertBox.add("娇兰之家随后会通过电话或者邮件直接联系您。"):Common.alertBox.add(e.msg)})}})}},"function"==typeof define&&define.amd?define(function(){return e}):this.controller=e}).call(this),window.addEventListener("load",function(){var e=new controller;e.init()});