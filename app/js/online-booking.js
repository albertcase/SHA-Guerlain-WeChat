(function(){"use strict";var e=function(){this.isShake=!1,this.mobileVal="",this.hasLogged=!1};e.prototype={init:function(){var e=this;e.bindEvent();var t=Common.queryString().servicefirst,n=Common.queryString().servicesecond;e.updateService(t,n)},bindEvent:function(){function e(e){this.children[0].value||(this.children[0].remove(),Common.addClass(this,"actived"))}var t=this;t.submitForm();for(var n=document.getElementsByTagName("select"),o=0;o<n.length;o++)n[o].addEventListener("change",e,!1)},presenvationDate:function(e){for(var t=document.getElementById("input-booking-date"),n=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],o=new Date,i=o.getFullYear(),a=o.getMonth()+1,l=o.getDate()+1,m=o.getDay(),r="",u=a,s=i,c=1;90>c;c++)u>0&&8>u?u%2?l>31&&(l=1,u++):2==u?s%4?l>28&&(l=1,u++):l>29&&(l=1,u++):l>30&&(l=1,u++):u>7&&13>u&&(u%2?l>30&&(l=1,u++):l>31&&(l=1,u++)),u>12&&(u=1,s++),m>6&&(m=0),"0"==e?6!=m&&(r=r+'<option value="'+u+"月"+l+"日 "+n[m]+'">'+u+"月"+l+"日 "+n[m]+"</option>"):r=r+'<option value="'+u+"月"+l+"日 "+n[m]+'">'+u+"月"+l+"日 "+n[m]+"</option>",l++,m++;t.innerHTML=r},formValidate:function(){var e=!0,t=document.getElementById("input-callname"),n=document.getElementById("input-surname"),o=document.getElementById("input-name"),i=document.getElementById("input-mobile"),a=document.getElementById("input-email");if(t.value?Common.removeClass(t.parentElement,"error"):(Common.addClass(t.parentElement,"error"),e=!1),n.value?Common.removeClass(n.parentElement,"error"):(Common.addClass(n.parentElement,"error"),e=!1),o.value?Common.removeClass(o.parentElement,"error"):(Common.addClass(o.parentElement,"error"),e=!1),i.value){var l=/^1\d{10}$/;l.test(i.value)?Common.removeClass(i.parentElement,"error"):(e=!1,Common.addClass(i.parentElement,"error"))}else Common.addClass(i.parentElement,"error"),e=!1;return a.value?Common.removeClass(a.parentElement,"error"):(Common.addClass(a.parentElement,"error"),e=!1),!!e},updateService:function(e,t){var n=this,o=$("#input-select-1"),i=($("#input-select-2"),$("#input-select-3"),$(".input-box-select-1"),$(".input-box-select-2"),$(".input-box-select-3"),$(".panel-select"),Api.serviceJson);if(o.on("change",function(){for(var e in i)i[e].title==$(this).val()&&n.initService(e,0)}),e)for(var a in i)if(i[a].title==e)if(i[a].type){for(var l in i[a].type)if(i[a].type[l].name==t)return void n.initService(a,l)}else n.initService(a,0);else a==i.length-1&&n.initService(0,0);else n.initService(0,0)},initService:function(e,t){var n=this,o=$("#input-select-1"),i=$("#input-select-2"),a=($("#input-select-3"),$(".input-box-select-1"),$(".input-box-select-2")),l=($(".input-box-select-3"),$(".panel-select"),Api.serviceJson),m="";n.presenvationDate(e);for(var r in l)m=m+'<option value="'+l[r].title+'">'+l[r].title+"</option>";o.html(m).val(l[e].title);var u="";if(l[e].type){a.removeClass("hide");for(var s in l[e].type)u=u+'<option value="'+l[e].type[s].name+'">'+l[e].type[s].name+"</option>";i.html(u),i.val(l[e].type[t].name)}else a.addClass("hide"),i.html("")},submitForm:function(){var e=this,t=$(".btn-submit"),n=!0;t.on("touchstart",function(t){if(t.preventDefault(),e.formValidate()){if(!n)return;n=!1;for(var o=document.getElementById("input-callname").value,i=document.getElementById("input-surname").value,a=document.getElementById("input-name").value,l=document.getElementById("input-mobile").value,m=document.getElementById("input-email").value,r=document.getElementById("input-select-1").value,u=document.getElementById("input-select-2").value,s=document.getElementById("input-select-3").value,c=document.getElementById("input-booking-date").value,d=document.getElementById("youradvice").value,v=document.getElementsByTagName("input-contact"),p="电子邮件",f=0;f<v.length;f++)v[f].checked&&(p=v[f].value);Api.submitAll({sex:o,first:i,second:a,mobile:l,email:m,type:p,bak1:r,bak2:u,bak3:s,date:c,comment:d},function(e){1==e.status?Common.alertBox.add("提交成功"):Common.alertBox.add(e.msg)})}})},countDown:function(){var e=59,t=document.getElementsByClassName("btn-getkeycode")[0],n=setInterval(function(){e--,Common.addClass(t,"countdown"),t.innerHTML=e,0>=e&&(clearInterval(n),Common.removeClass(t,"countdown"),t.innerHTML="")},1e3)},getRedpacket:function(){Api.getRedpacket({},function(e){1==e.status?Common.removeClass(document.getElementsByClassName("qrcode-pop")[0],"hide"):Common.alertBox.add(e.msg)})},compareCommand:function(e){}},"function"==typeof define&&define.amd?define(function(){return e}):this.controller=e}).call(this),window.addEventListener("load",function(){var e=new controller;e.init()});